<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to R</title>
  <meta name="description" content="Workshop materials for Intro to R">
  <meta name="generator" content="bookdown 0.4.2 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Workshop materials for Intro to R" />
  <meta name="github-repo" content="cengel/R-intro" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to R" />
  
  <meta name="twitter:description" content="Workshop materials for Intro to R" />
  

<meta name="author" content="Claudia A Engel">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="gettingstarted.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="backgroud.html"><a href="backgroud.html"><i class="fa fa-check"></i><b>1</b> R and Rstudio</a></li>
<li class="chapter" data-level="2" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>2</b> Getting Started with R</a></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Working with tabular data in R</a><ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#loading-tabular-data"><i class="fa fa-check"></i><b>3.1</b> Loading tabular data</a></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#inspecting-data.frame-objects"><i class="fa fa-check"></i><b>3.2</b> Inspecting <code>data.frame</code> Objects</a></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#indexing-and-subsetting-data-frames"><i class="fa fa-check"></i><b>3.3</b> Indexing and subsetting data frames</a></li>
<li class="chapter" data-level="3.4" data-path="data.html"><a href="data.html#conditional-subsetting"><i class="fa fa-check"></i><b>3.4</b> Conditional subsetting</a></li>
<li class="chapter" data-level="3.5" data-path="data.html"><a href="data.html#adding-and-removing-rows-and-columns"><i class="fa fa-check"></i><b>3.5</b> Adding and removing rows and columns</a></li>
<li class="chapter" data-level="3.6" data-path="data.html"><a href="data.html#categorical-data-factors"><i class="fa fa-check"></i><b>3.6</b> Categorical data: factors</a><ul>
<li class="chapter" data-level="3.6.1" data-path="data.html"><a href="data.html#converting-factors"><i class="fa fa-check"></i><b>3.6.1</b> Converting factors</a></li>
<li class="chapter" data-level="3.6.2" data-path="data.html"><a href="data.html#renaming-factors"><i class="fa fa-check"></i><b>3.6.2</b> Renaming factors</a></li>
<li class="chapter" data-level="3.6.3" data-path="data.html"><a href="data.html#using-stringsasfactorsfalse"><i class="fa fa-check"></i><b>3.6.3</b> Using <code>stringsAsFactors=FALSE</code></a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data.html"><a href="data.html#dates"><i class="fa fa-check"></i><b>3.7</b> Dates</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Working with tabular data in R</h1>
<blockquote>
<p>Learning Objectives</p>
<ul>
<li>Load external data from a .csv file into a data frame in R with <code>read.csv()</code></li>
<li>Find basic properties of a data frames including size, class or type of the columns, names of rows and columns by using <code>str()</code>, <code>nrow()</code>, <code>ncol()</code>, <code>dim()</code>, <code>length()</code> , <code>colnames()</code>, <code>rownames()</code></li>
<li>Use <code>head()</code> and <code>tail()</code> to inspect rows of a data frame.</li>
<li>Generate summary statistics for a data frame</li>
<li>Use indexing to select rows and columns</li>
<li>Use logical conditions to select rows and columns</li>
<li>Add columns and rows to a data frame</li>
<li>Manipulate categorical data with <code>factors</code>, <code>levels()</code> and <code>as.character()</code></li>
<li>Change how character strings are handled in a data frame.</li>
<li>Format dates in R and calculate time differences</li>
<li>Use <code>df$new_col &lt;- new_col</code> to add a new column to a data frame.</li>
<li>Use <code>cbind()</code> to add a new column to a data frame.</li>
<li>Use <code>rbind()</code> to add a new row to a data frame.</li>
<li>Use <code>na.omit()</code> to remove rows from a data frame with <code>NA</code> values.</li>
</ul>
</blockquote>
<hr />
<div id="loading-tabular-data" class="section level2">
<h2><span class="header-section-number">3.1</span> Loading tabular data</h2>
<p>One the most common ways of getting data into R is to read in a table. And – you guessed it – we read it into a data frame! We will take a simple CSV file as example. <a href="https://support.bigcommerce.com/articles/Public/What-is-a-CSV-file-and-how-do-I-save-my-spreadsheet-as-one">What is a CSV file?</a></p>
<p>You may know about <a href="https://openpolicing.stanford.edu">the Stanford Open Policing Project</a> and we will be working a sample dataset from their repository (<a href="https://openpolicing.stanford.edu/data/" class="uri">https://openpolicing.stanford.edu/data/</a>). It contains information about traffic stops for blacks and whites in the state of Mississippi during January 2013 to mid-July of 2016.</p>
<p>We are going to use the R function <code>download.file()</code> to download the CSV file that contains the traffic stop data, and we will use <code>read.csv()</code> to load into memory the content of the CSV file as an object of class <code>data.frame</code>.</p>
<p>Download the traffic stop data from here: <a href="https://github.com/cengel/R-intro/raw/master/data/MS_trafficstops_bw.csv" class="uri">https://github.com/cengel/R-intro/raw/master/data/MS_trafficstops_bw.csv</a></p>
<p>To download the data into your local <code>data/</code> subdirectory, run the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">download.file</span>(<span class="st">&quot;https://github.com/cengel/R-intro/raw/master/data/MS_trafficstops_bw.csv&quot;</span>,
              <span class="st">&quot;data/MS_trafficstops_bw.csv&quot;</span>)</code></pre></div>
<p>You are now ready to load the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trafficstops &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/MS_trafficstops_bw.csv&#39;</span>)</code></pre></div>
<p>This statement doesn’t produce any output because, as you might recall, assignments don’t display anything. If we want to check that our data has been loaded, we can print the variable’s value: <code>trafficstops</code>.</p>
<p>Wow… that was a lot of output. At least it means the data loaded properly. Let’s check the top (the first 6 lines) of this data frame using the function <code>head()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(trafficstops)</code></pre></div>
<pre><code>#&gt;              id state  stop_date       county_name county_fips
#&gt; 1 MS-2013-00001    MS 2013-01-01      Jones County       28067
#&gt; 2 MS-2013-00002    MS 2013-01-01 Lauderdale County       28075
#&gt; 3 MS-2013-00003    MS 2013-01-01       Pike County       28113
#&gt; 4 MS-2013-00004    MS 2013-01-01    Hancock County       28045
#&gt; 5 MS-2013-00005    MS 2013-01-01     Holmes County       28051
#&gt; 6 MS-2013-00006    MS 2013-01-01    Jackson County       28059
#&gt;            police_department driver_gender driver_birthdate driver_race
#&gt; 1 Mississippi Highway Patrol             M       1950-06-14       Black
#&gt; 2 Mississippi Highway Patrol             M       1967-04-06       Black
#&gt; 3 Mississippi Highway Patrol             M       1974-04-15       Black
#&gt; 4 Mississippi Highway Patrol             M       1981-03-23       White
#&gt; 5 Mississippi Highway Patrol             M       1992-08-03       White
#&gt; 6 Mississippi Highway Patrol             F       1960-05-02       White
#&gt;                                                 violation_raw officer_id
#&gt; 1                     Seat belt not used properly as required       J042
#&gt; 2                                            Careless driving       B026
#&gt; 3 Speeding - Regulated or posted speed limit and actual speed       M009
#&gt; 4 Speeding - Regulated or posted speed limit and actual speed       K035
#&gt; 5 Speeding - Regulated or posted speed limit and actual speed       D028
#&gt; 6 Speeding - Regulated or posted speed limit and actual speed       K023</code></pre>
</div>
<div id="inspecting-data.frame-objects" class="section level2">
<h2><span class="header-section-number">3.2</span> Inspecting <code>data.frame</code> Objects</h2>
<p>As you may recall, a data frame in R is a special case of a list, and a representation of data where the columns are vectors that all have the same length. Because the columns are vectors, they all contain the same type of data (e.g., characters, integers, factors, etc.).</p>
<p>We can see this when inspecting the <b>str</b>ucture of a data frame with the function <code>str()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(trafficstops)</code></pre></div>
<pre><code>#&gt; &#39;data.frame&#39;:    211211 obs. of  11 variables:
#&gt;  $ id               : Factor w/ 211211 levels &quot;MS-2013-00001&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
#&gt;  $ state            : Factor w/ 1 level &quot;MS&quot;: 1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ stop_date        : Factor w/ 1288 levels &quot;2013-01-01&quot;,&quot;2013-01-02&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ county_name      : Factor w/ 82 levels &quot;Adams County&quot;,..: 34 38 57 23 26 30 30 22 26 26 ...
#&gt;  $ county_fips      : int  28067 28075 28113 28045 28051 28059 28059 28043 28051 28051 ...
#&gt;  $ police_department: Factor w/ 1 level &quot;Mississippi Highway Patrol&quot;: 1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ driver_gender    : Factor w/ 3 levels &quot;&quot;,&quot;F&quot;,&quot;M&quot;: 3 3 3 3 3 2 2 2 3 3 ...
#&gt;  $ driver_birthdate : Factor w/ 21423 levels &quot;&quot;,&quot;1930-01-11&quot;,..: 3558 9575 12137 14670 18820 7061 4504 19135 2755 15878 ...
#&gt;  $ driver_race      : Factor w/ 3 levels &quot;&quot;,&quot;Black&quot;,&quot;White&quot;: 2 2 2 3 3 3 3 3 3 3 ...
#&gt;  $ violation_raw    : Factor w/ 19 levels &quot;??&quot;,&quot;Careless driving&quot;,..: 17 2 19 19 19 19 19 19 19 19 ...
#&gt;  $ officer_id       : Factor w/ 897 levels &quot;&quot;,&quot;A003&quot;,&quot;A004&quot;,..: 519 52 635 560 212 550 559 205 723 723 ...</code></pre>
<p>We already saw how the functions <code>head()</code> and <code>str()</code> can be useful to check the content and the structure of a data frame. Here is a non-exhaustive list of functions to get a sense of the content/structure of the data. Let’s try them out!</p>
<ul>
<li>Size:
<ul>
<li><code>dim(trafficstops)</code> - returns a vector with the number of rows in the first element, and the number of columns as the second element (the <strong>dim</strong>ensions of the object)</li>
<li><code>nrow(trafficstops)</code> - returns the number of rows</li>
<li><code>ncol(trafficstops)</code> - returns the number of columns</li>
<li><code>length(trafficstops)</code> - returns number of columns</li>
</ul></li>
<li>Content:
<ul>
<li><code>head(trafficstops)</code> - shows the first 6 rows</li>
<li><code>tail(trafficstops)</code> - shows the last 6 rows</li>
</ul></li>
<li>Names:
<ul>
<li><code>names(trafficstops)</code> - returns the column names (synonym of <code>colnames()</code> for <code>data.frame</code> objects)</li>
<li><code>rownames(trafficstops)</code> - returns the row names</li>
</ul></li>
<li>Summary:
<ul>
<li><code>str(trafficstops)</code> - structure of the object and information about the class, length and content of each column</li>
<li><code>summary(trafficstops)</code> - summary statistics for each column</li>
</ul></li>
</ul>
<p>Note: most of these functions are “generic”, they can be used on other types of objects besides <code>data.frame</code>.</p>
<blockquote>
<h3>
Challenge
</h3>
<p>Based on the output of <code>str(trafficstops)</code>, can you answer the following questions?</p>
<ul>
<li>What is the class of the object <code>trafficstops</code>?</li>
<li>How many rows and how many columns are in this object?</li>
<li>How many counties have been recorded in this dataset?</li>
</ul>
</blockquote>
<!---

--->
</div>
<div id="indexing-and-subsetting-data-frames" class="section level2">
<h2><span class="header-section-number">3.3</span> Indexing and subsetting data frames</h2>
<p>Our gapminder data frame has rows and columns (it has 2 dimensions), if we want to extract some specific data from it, we need to specify the “coordinates” we want from it. Row numbers come first, followed by column numbers. However, note that different ways of specifying these coordinates lead to results with different classes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trafficstops[<span class="dv">1</span>, <span class="dv">1</span>]   <span class="co"># first element in the first column of the data frame (as a vector)</span>
trafficstops[<span class="dv">1</span>, <span class="dv">6</span>]   <span class="co"># first element in the 6th column (as a vector)</span>
trafficstops[, <span class="dv">1</span>]    <span class="co"># first column in the data frame (as a vector)</span>
trafficstops[<span class="dv">1</span>]      <span class="co"># first column in the data frame (as a data.frame)</span>
trafficstops[<span class="dv">1</span>:<span class="dv">3</span>, <span class="dv">7</span>] <span class="co"># first three elements in the 7th column (as a vector)</span>
trafficstops[<span class="dv">3</span>, ]    <span class="co"># the 3rd element for all columns (as a data.frame)</span>
head_trafficstops &lt;-<span class="st"> </span>trafficstops[<span class="dv">1</span>:<span class="dv">6</span>, ] <span class="co"># equivalent to head(gapminder)</span></code></pre></div>
<p><code>:</code> is a special function that creates numeric vectors of integers in increasing or decreasing order, test <code>1:10</code> and <code>10:1</code> for instance.</p>
<p>You can also exclude certain parts of a data frame using the “<code>-</code>” sign:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trafficstops[,-<span class="dv">1</span>]          <span class="co"># The whole data frame, except the first column</span>
trafficstops[-<span class="kw">c</span>(<span class="dv">7</span>:<span class="dv">211211</span>),] <span class="co"># Equivalent to head(trafficstops)</span></code></pre></div>
<p>As well as using numeric values to subset a <code>data.frame</code> (or <code>matrix</code>), columns can be called by name, using one of the four following notations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trafficstops[<span class="st">&quot;violation_raw&quot;</span>]       <span class="co"># Result is a data.frame</span>
trafficstops[, <span class="st">&quot;violation_raw&quot;</span>]     <span class="co"># Result is a vector</span>
trafficstops[[<span class="st">&quot;violation_raw&quot;</span>]]     <span class="co"># Result is a vector</span>
trafficstops$violation_raw          <span class="co"># Result is a vector</span></code></pre></div>
<p>For our purposes, the last three notations are equivalent. RStudio knows about the columns in your data frame, so you can take advantage of the autocompletion feature to get the full and correct column name.</p>
<blockquote>
<h3>
Challenge
</h3>
<ol style="list-style-type: decimal">
<li><p>Create a <code>data.frame</code> (<code>trafficstops_200</code>) containing only the observations from row 200 of the <code>trafficstops</code> dataset.</p></li>
<li><p>Notice how <code>nrow()</code> gave you the number of rows in a <code>data.frame</code>?</p>
<ul>
<li>Use that number to pull out just that last row in the data frame.</li>
<li>Compare that with what you see as the last row using <code>tail()</code> to make sure it’s meeting expectations.</li>
<li>Pull out that last row using <code>nrow()</code> instead of the row number.</li>
<li>Create a new data frame object (<code>trafficstops_last</code>) from that last row.</li>
</ul></li>
<li><p>Use <code>nrow()</code> to extract the row that is in the middle of the data frame. Store the content of this row in an object named <code>trafficstops_middle</code>.</p></li>
<li><p>Combine <code>nrow()</code> with the <code>-</code> notation above to reproduce the behavior of <code>head(trafficstops)</code> keeping just the first through 6th rows of the trafficstops dataset.</p></li>
</ol>
</blockquote>
<!---

```r
## Answers
trafficstops_200 <- trafficstops[200, ]
trafficstops_last <- trafficstops[nrow(trafficstops), ]
trafficstops_middle <- trafficstops[nrow(trafficstops)/2, ]
trafficstops_head <- trafficstops[-c(7:nrow(trafficstops)),]
```
--->
</div>
<div id="conditional-subsetting" class="section level2">
<h2><span class="header-section-number">3.4</span> Conditional subsetting</h2>
<p>Often times we need to extract a subset of a data frame based on certain conditions. For example, if we wanted to look at traffic stops in Tallahatchie County only we could say:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the condition:</span>
trafficstops$county_name ==<span class="st"> &quot;Tallahatchie County&quot;</span> <span class="co"># returns a logical vector of the length of the column</span>
<span class="co"># use this vector to extract rows and all columns</span>
trafficstops[trafficstops$county_name ==<span class="st"> &quot;Tallahatchie County&quot;</span>, ] <span class="co"># note the comma: we want all columns</span>
<span class="co"># assign it to a new data frame</span>
Tallahatchie_trafficstops &lt;-<span class="st"> </span>trafficstops[trafficstops$county_name ==<span class="st"> &quot;Tallahatchie County&quot;</span>, ]</code></pre></div>
<p>This is also a possibility:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Tallahatchie_trafficstops &lt;-<span class="st"> </span><span class="kw">subset</span>(trafficstops, county_name ==<span class="st"> &quot;Tallahatchie County&quot;</span>)
<span class="kw">nrow</span>(Tallahatchie_trafficstops) <span class="co"># 393 stops in Tallahatchie County!</span></code></pre></div>
<pre><code>#&gt; [1] 393</code></pre>
<p>These commands are from the R base package. In the R Data Wrangling workshop we will discuss a different way of subsetting using functions from the <code>tidyverse</code> package.</p>
<blockquote>
<h3>
Challenge
</h3>
<ul>
<li>Use subsetting to extract trafficstops in Hancock, Harrison, and Jackson Counties into a separate data frame <code>coastal_counties</code>.</li>
<li>Using <code>coastal_counties</code>, count the number of Black and White drivers in the three counties.</li>
<li>Bonus: How does the ratio of Black to White stops in the three coastal counties compare to the same ratio for stops in the entire state of Mississippi?</li>
</ul>
</blockquote>
<!---

```r
## Answers
coastal_counties <- trafficstops[trafficstops$county_name %in% c("Hancock County", "Harrison County", "Jackson County"), ]
# or
coastal_counties <- subset(trafficstops, county_name %in% c("Hancock County", "Harrison County", "Jackson County"))

# counts 
sum(coastal_counties$driver_race == "Black")
sum(coastal_counties$driver_race == "White")

# ratios
sum(coastal_counties$driver_race == "Black")/sum(coastal_counties$driver_race == "White")

sum(trafficstops$driver_race == "Black")/sum(trafficstops$driver_race == "White")
```
--->
</div>
<div id="adding-and-removing-rows-and-columns" class="section level2">
<h2><span class="header-section-number">3.5</span> Adding and removing rows and columns</h2>
<p>To add a new column to the data frame we can use the <code>cbind()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_col &lt;-<span class="st"> </span><span class="kw">row.names</span>(trafficstops)
trafficstops_withnewcol &lt;-<span class="st"> </span><span class="kw">cbind</span>(trafficstops, new_col)
<span class="kw">head</span>(trafficstops_withnewcol)</code></pre></div>
<pre><code>#&gt;              id state  stop_date       county_name county_fips
#&gt; 1 MS-2013-00001    MS 2013-01-01      Jones County       28067
#&gt; 2 MS-2013-00002    MS 2013-01-01 Lauderdale County       28075
#&gt; 3 MS-2013-00003    MS 2013-01-01       Pike County       28113
#&gt; 4 MS-2013-00004    MS 2013-01-01    Hancock County       28045
#&gt; 5 MS-2013-00005    MS 2013-01-01     Holmes County       28051
#&gt; 6 MS-2013-00006    MS 2013-01-01    Jackson County       28059
#&gt;            police_department driver_gender driver_birthdate driver_race
#&gt; 1 Mississippi Highway Patrol             M       1950-06-14       Black
#&gt; 2 Mississippi Highway Patrol             M       1967-04-06       Black
#&gt; 3 Mississippi Highway Patrol             M       1974-04-15       Black
#&gt; 4 Mississippi Highway Patrol             M       1981-03-23       White
#&gt; 5 Mississippi Highway Patrol             M       1992-08-03       White
#&gt; 6 Mississippi Highway Patrol             F       1960-05-02       White
#&gt;                                                 violation_raw officer_id
#&gt; 1                     Seat belt not used properly as required       J042
#&gt; 2                                            Careless driving       B026
#&gt; 3 Speeding - Regulated or posted speed limit and actual speed       M009
#&gt; 4 Speeding - Regulated or posted speed limit and actual speed       K035
#&gt; 5 Speeding - Regulated or posted speed limit and actual speed       D028
#&gt; 6 Speeding - Regulated or posted speed limit and actual speed       K023
#&gt;   new_col
#&gt; 1       1
#&gt; 2       2
#&gt; 3       3
#&gt; 4       4
#&gt; 5       5
#&gt; 6       6</code></pre>
<p>Alternatively, we can also add a new column adding the new column name after the <code>$</code> sign then assigning the value, like below. Note that this will change the original data frame, which you may not always want to do.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">trafficstops$row_numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>:<span class="kw">nrow</span>(trafficstops))
trafficstops$all_false &lt;-<span class="st"> </span><span class="ot">FALSE</span>  <span class="co"># what do you think will happen here?</span></code></pre></div>
<p>There is an equivalent function, <code>rbind()</code> to add a new row to a data frame. I use this far less frequently than the column equivalent. The one thing to keep in mind is that the row to be added to the data frame needs to match the order and type of columns in the data frame. Remember that R’s way to store multiple different data types in one object is a <code>list</code>. So if we wanted to add a new row to <code>trafficstops</code> we would say:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_row &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id=</span><span class="st">&quot;MS-2017-12345&quot;</span>, <span class="dt">state=</span><span class="st">&quot;MS&quot;</span>, <span class="dt">stop_date=</span><span class="st">&quot;2017-08-24&quot;</span>,
                <span class="dt">county_name=</span><span class="st">&quot;Tallahatchie County&quot;</span>, <span class="dt">county_fips=</span><span class="dv">12345</span>,
                <span class="dt">police_department=</span><span class="st">&quot;MSHP&quot;</span>, <span class="dt">driver_gender=</span><span class="st">&quot;F&quot;</span>, <span class="dt">driver_birthdate=</span><span class="st">&quot;1999-06-14&quot;</span>,
                <span class="dt">driver_race=</span><span class="st">&quot;Hispanic&quot;</span>, <span class="dt">violation_raw=</span><span class="st">&quot;Speeding&quot;</span>, <span class="dt">officer_id=</span><span class="st">&quot;ABCD&quot;</span>)

trafficstops_withnewrow &lt;-<span class="st"> </span><span class="kw">rbind</span>(trafficstops, new_row)
<span class="kw">tail</span>(trafficstops_withnewrow)</code></pre></div>
<pre><code>#&gt;                   id state  stop_date         county_name county_fips
#&gt; 211207 MS-2016-24293    MS 2016-07-09       George County       28039
#&gt; 211208 MS-2016-24294    MS 2016-07-10       Copiah County       28029
#&gt; 211209 MS-2016-24295    MS 2016-07-11      Grenada County       28043
#&gt; 211210 MS-2016-24296    MS 2016-07-14       Copiah County       28029
#&gt; 211211 MS-2016-24297    MS 2016-07-14       Copiah County       28029
#&gt; 211212 MS-2017-12345    MS 2017-08-24 Tallahatchie County       12345
#&gt;                 police_department driver_gender driver_birthdate
#&gt; 211207 Mississippi Highway Patrol             M       1992-07-14
#&gt; 211208 Mississippi Highway Patrol             M       1975-12-23
#&gt; 211209 Mississippi Highway Patrol             M       1998-02-02
#&gt; 211210 Mississippi Highway Patrol             F       1970-06-14
#&gt; 211211 Mississippi Highway Patrol             M       1948-03-11
#&gt; 211212                       MSHP             F       1999-06-14
#&gt;        driver_race
#&gt; 211207       White
#&gt; 211208       Black
#&gt; 211209       White
#&gt; 211210       White
#&gt; 211211       White
#&gt; 211212    Hispanic
#&gt;                                                      violation_raw
#&gt; 211207 Speeding - Regulated or posted speed limit and actual speed
#&gt; 211208 Speeding - Regulated or posted speed limit and actual speed
#&gt; 211209                     Seat belt not used properly as required
#&gt; 211210       Expired or no non-commercial driver license or permit
#&gt; 211211                     Seat belt not used properly as required
#&gt; 211212                                                    Speeding
#&gt;        officer_id
#&gt; 211207       K025
#&gt; 211208       C033
#&gt; 211209       D014
#&gt; 211210       C015
#&gt; 211211       C015
#&gt; 211212       ABCD</code></pre>
<p>A convenient function to know about is <code>na.omit()</code>. It will remove all rows from a data frame that have at least one column with <code>NA</code> values.</p>
<blockquote>
<h3>
Challenge
</h3>
<ul>
<li>Given the following data frame:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfr &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">col_1 =</span> <span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">3</span>), 
                  <span class="dt">col_2 =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="st">&quot;b&quot;</span>), 
                  <span class="dt">col_3 =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">NA</span>, <span class="ot">FALSE</span>))</code></pre></div>
<p>What would you expect the following commands to return?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(dfr)
<span class="kw">nrow</span>(<span class="kw">na.omit</span>(dfr))</code></pre></div>
</blockquote>
<!---

```r
## Answers
nrow(dfr) # 3
nrow(na.omit(dfr)) # 1
```
--->
</div>
<div id="categorical-data-factors" class="section level2">
<h2><span class="header-section-number">3.6</span> Categorical data: factors</h2>
<p>When we did <code>str(trafficstops)</code> we saw that only one of the columns are numeric (<code>county_fips</code>), all the others are of a special class called a <code>factor</code>. Factors are very useful and are actually something that make R particularly well suited to working with data, so we’re going to spend a little time introducing them.</p>
<p>Factors are used to represent categorical data. Factors can be ordered or unordered, and understanding them is necessary for statistical analysis and for plotting.</p>
<p>Factors are stored as integers, and have labels (text) associated with these unique integers. While factors look (and often behave) like character vectors, they are actually integers under the hood, and you need to be careful when treating them like strings.</p>
<p>Once created, factors can only contain a pre-defined set of values, known as <em>levels</em>. By default, R always sorts <em>levels</em> in alphabetical order. For instance, if you have a factor with 2 levels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">party &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;republican&quot;</span>, <span class="st">&quot;democrat&quot;</span>, <span class="st">&quot;democrat&quot;</span>, <span class="st">&quot;republican&quot;</span>))</code></pre></div>
<p>R will assign <code>1</code> to the level <code>&quot;democrat&quot;</code> and <code>2</code> to the level <code>&quot;republican&quot;</code> (because <code>d</code> comes before <code>r</code>, even though the first element in this vector is <code>&quot;republican&quot;</code>). You can check this by using the function <code>levels()</code>, and check the number of levels using <code>nlevels()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(party)
<span class="kw">nlevels</span>(party)</code></pre></div>
<p>Sometimes, the order of the factors does not matter, other times you might want to specify the order because it is meaningful (e.g., “low”, “medium”, “high”), it improves your visualization, or it is required by a particular type of analysis. Here, one way to reorder our levels in the <code>party</code> vector would be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">party <span class="co"># current order</span></code></pre></div>
<pre><code>#&gt; [1] republican democrat   democrat   republican
#&gt; Levels: democrat republican</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">party &lt;-<span class="st"> </span><span class="kw">factor</span>(party, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;republican&quot;</span>, <span class="st">&quot;democrat&quot;</span>))
party <span class="co"># after re-ordering</span></code></pre></div>
<pre><code>#&gt; [1] republican democrat   democrat   republican
#&gt; Levels: republican democrat</code></pre>
<p>In R’s memory, these factors are represented by integers (1, 2, 3), but are more informative than integers because factors are self describing: <code>&quot;democrat&quot;</code>, <code>&quot;republican&quot;</code> is more descriptive than <code>1</code>, <code>2</code>. Which one is “republican”? You wouldn’t be able to tell just from the integer data. Factors, on the other hand, have this information built in. It is particularly helpful when there are many levels (like the country names in our example dataset).</p>
<div id="converting-factors" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Converting factors</h3>
<p>If you need to convert a factor to a character vector, you use <code>as.character(x)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.character</span>(party)</code></pre></div>
<p>Converting factors where the levels appear as numbers (such as concentration levels, or years) to a numeric vector is a little trickier. One method is to convert factors to characters and then numbers. Another method is to use the <code>levels()</code> function. Compare:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="dv">1990</span>, <span class="dv">1983</span>, <span class="dv">1977</span>, <span class="dv">1998</span>, <span class="dv">1990</span>))
<span class="kw">as.numeric</span>(f)               <span class="co"># wrong! and there is no warning...</span>
<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(f)) <span class="co"># works...</span>
<span class="kw">as.numeric</span>(<span class="kw">levels</span>(f))[f]    <span class="co"># The recommended way.</span></code></pre></div>
<p>Notice that in the <code>levels()</code> approach, three important steps occur:</p>
<ul>
<li>We obtain all the factor levels using <code>levels(f)</code></li>
<li>We convert these levels to numeric values using <code>as.numeric(levels(f))</code></li>
<li>We then access these numeric values using the underlying integers of the vector <code>f</code> inside the square brackets</li>
</ul>
</div>
<div id="renaming-factors" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Renaming factors</h3>
<p>When your data is stored as a factor, you can use the <code>plot()</code> function to get a quick glance at the number of observations represented by each factor level. Let’s look at the number of blacks and whites in the dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## bar plot of the number of black and white drivers stopped:
<span class="kw">plot</span>(trafficstops$driver_race)</code></pre></div>
<p><img src="R-intro_files/figure-html/driver-race-barplot-1.png" width="672" /></p>
<p>There seem to be a number of individuals for which the race information hasn’t been recorded.</p>
<p>Additionally, for these individuals, there is no label to indicate that the information is missing. Let’s rename this label to something more meaningful. Before doing that, we’re going to pull out the data on race and work with that data, so we’re not modifying the working copy of the data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">race &lt;-<span class="st"> </span>trafficstops$driver_race
<span class="kw">head</span>(race)</code></pre></div>
<pre><code>#&gt; [1] Black Black Black White White White
#&gt; Levels:  Black White</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(race)</code></pre></div>
<pre><code>#&gt; [1] &quot;&quot;      &quot;Black&quot; &quot;White&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(race)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;Missing&quot;</span>
<span class="kw">levels</span>(race)</code></pre></div>
<pre><code>#&gt; [1] &quot;Missing&quot; &quot;Black&quot;   &quot;White&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(race)</code></pre></div>
<pre><code>#&gt; [1] Black Black Black White White White
#&gt; Levels: Missing Black White</code></pre>
<blockquote>
<h3>
Challenge
</h3>
<ul>
<li>Rename “Black” to “African American”.</li>
<li>Now that we have renamed the factor level to “Missing”, can you recreate the barplot such that “Missing” is last (to the right)?</li>
</ul>
</blockquote>
<!---

```r
## Answers
levels(race)[2] <- c("African American")
race <- factor(race, levels = c("African American", "White", "Missing"))
plot(race)
```

<img src="R-intro_files/figure-html/correct-order-1.png" width="672" />
--->
</div>
<div id="using-stringsasfactorsfalse" class="section level3">
<h3><span class="header-section-number">3.6.3</span> Using <code>stringsAsFactors=FALSE</code></h3>
<p>By default, when building or importing a data frame with <code>read.csv()</code>, the columns that contain characters (i.e., text) are coerced (=converted) into the <code>factor</code> data type. Depending on what you want to do with the data, you may want to keep these columns as <code>character</code>. To do so, <code>read.csv()</code> and <code>read.table()</code> have an argument called <code>stringsAsFactors</code> which can be set to <code>FALSE</code>.</p>
<p>In most cases, it’s preferable to set <code>stringsAsFactors = FALSE</code> when importing your data, and converting as a factor only the columns that require this data type.</p>
<p>Compare the output of <code>str(trafficstops)</code> when setting <code>stringsAsFactors = TRUE</code> (default) and <code>stringsAsFactors = FALSE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Compare the difference between when the data are being read as
## `factor`, and when they are being read as `character`.
trafficstops &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/MS_policing_bw.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">TRUE</span>)
<span class="kw">str</span>(trafficstops)
trafficstops &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/MS_policing_bw.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">str</span>(trafficstops)
## Convert the column &quot;driver_race&quot; into a factor
trafficstops$driver_race &lt;-<span class="st"> </span><span class="kw">factor</span>(trafficstops$driver_race)</code></pre></div>
<blockquote>
<h3>
Challenge
</h3>
<p>Can you predict the class for each of the columns in the following example? Check your guesses using <code>str(country_climate)</code>: * Are they what you expected? Why? Why not? * What would have been different if we had added <code>stringsAsFactors = FALSE</code> to this call? * What would you need to change to ensure that each column had the accurate data type?</p>
<pre><code>```r
country_climate &lt;- data.frame(
       country=c(&quot;Canada&quot;, &quot;Panama&quot;, &quot;South Africa&quot;, &quot;Australia&quot;),
       climate=c(&quot;cold&quot;, &quot;hot&quot;, &quot;temperate&quot;, &quot;hot/temperate&quot;),
       temperature=c(10, 30, 18, &quot;15&quot;),
       northern_hemisphere=c(TRUE, TRUE, FALSE, &quot;FALSE&quot;),
       has_kangaroo=c(FALSE, FALSE, FALSE, 1)
       )
```</code></pre>
</blockquote>
<!--- Answers



-->
<p>The automatic conversion of data type is sometimes a blessing, sometimes an annoyance. Be aware that it exists, learn the rules, and double check that data you import in R are of the correct type within your data frame. If not, use it to your advantage to detect mistakes that might have been introduced during data entry (a letter in a column that should only contain numbers for instance).</p>
</div>
</div>
<div id="dates" class="section level2">
<h2><span class="header-section-number">3.7</span> Dates</h2>
<p>One of the most common issues that new (and experienced!) R users have is converting date and time information into a variable that is appropriate and usable during analyses. If you have control over your data the best practice for dealing with date data is to ensure that each component of your date is stored as a separate variable, i.e a separate column for day, month, and year. However, often we do not have control and the date is stored in one single column and with varying order and separating characters between its components.</p>
<p>Using <code>str()</code>, we can see that both dates in our data frame <code>stop_date</code> and <code>driver_birthdate</code> are each stored in one column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(trafficstops)</code></pre></div>
<p>As an example for how to work with dates let us see if there are seasonal differences in the number of traffic stops.</p>
<p>We’re going to be using the <code>ymd()</code> function from the package <strong><code>lubridate</code></strong>. This function is designed to take a vector representing year, month, and day and convert that information to a POSIXct vector. POSIXct is a class of data recognized by R as being a date or date and time. The argument that the function requires is relatively flexible, but, as a best practice, is a character vector formatted as “YYYY-MM-DD”.</p>
<p>Start by loading the required package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stop_date &lt;-<span class="st"> </span><span class="kw">ymd</span>(trafficstops$stop_date)
<span class="kw">str</span>(stop_date) <span class="co"># notice the &#39;date&#39; class</span></code></pre></div>
<p>The <code>ymd</code> function also has nicely taken care of the fact that the original format of the date column is a factor!</p>
<p>We can now easily extract year, month, and date using the respective functions: <code>year()</code>, <code>month()</code>, and <code>day()</code> like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">factor</span>(<span class="kw">year</span>(stop_date))) <span class="co">#convert year to factor to plot</span></code></pre></div>
<p><img src="R-intro_files/figure-html/yearly-stops-1.png" width="672" /></p>
<blockquote>
<h3>
Challenge
</h3>
<ul>
<li>Are there more stops in certain months of the year or certain days of the month?</li>
</ul>
</blockquote>
<!---

```r
## Answers
plot(factor(month(stop_date)))
```

<img src="R-intro_files/figure-html/plot-seasonal-stops-1.png" width="672" />

```r
plot(factor(day(stop_date)))
```

<img src="R-intro_files/figure-html/plot-seasonal-stops-2.png" width="672" />
--->
<blockquote>
<h3>
Challenge
</h3>
<ul>
<li>Determine the age of the driver in years (approximate) at the time of the stop:</li>
<li>Extract <code>driver_birthdate</code> into a vector <code>birth_date</code></li>
<li>Create a new vector <code>age</code> with the driver’s age at the time of the stop in years</li>
<li>Coerce <code>age</code> to a factor and use the <code>plot</code> function to check your results. What do you find?</li>
</ul>
</blockquote>
<!---

```r
## Answers
birth_date <- ymd(trafficstops$driver_birthdate)
age <- stop_date - birth_date
# or
age <- year(stop_date) - year(birth_date)
plot(factor(age)) # Negative age!
```

<img src="R-intro_files/figure-html/calculate-age-answer-1.png" width="672" />

```r
#or
hist(age)
```

<img src="R-intro_files/figure-html/calculate-age-answer-2.png" width="672" />
--->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gettingstarted.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cengel/R-intro/edit/master/03-working-with-data.Rmd",
"text": "Edit"
},
"download": ["R-intro.pdf", "R-intro.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
